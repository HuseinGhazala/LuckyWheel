# حل خطأ: تعذر العثور على دالة doGet

اتبع الخطوات **بالترتيب** ولا تتخطّ أي خطوة.

---

## إذا ظهرت: "عذرا، يتعذر فتح الملف في الوقت الحالي"

هذه الرسالة تظهر عندما تفتح **رابطاً خاطئاً**. راجع التالي:

| الهدف | الطريقة الصحيحة |
|--------|------------------|
| **فتح محرر السكربت (لتعديل الكود)** | لا تفتح رابطاً من شريط العناوين. اذهب إلى **Google Drive** → افتح **ملف Google Sheet** (الجدول) → من القائمة: **الإضافات** → **Apps Script**. |
| **فتح تطبيق الويب (لاختبار جلب الإعدادات)** | استخدم الرابط الذي نسخته عند النشر، وشكله: `https://script.google.com/macros/s/XXXXX/exec` وأضف في آخره: `?action=getSettings`. |

**لا** تفتح رابطاً يشبه: `drive.google.com/...` أو رابط "ملف" أو "مشروع" — استخدم فقط الطريقتين أعلاه.

---

## الخطوة 1: مشروع واحد وملف واحد فقط

1. اذهب إلى **Google Drive** وافتح **ملف الـ Sheet** (الجداول) المرتبط بعجلة الحظ.
2. من القائمة: **الإضافات** → **Apps Script**.
3. في الجانب الأيسر ستظهر قائمة الملفات (مثل `Code.gs` أو `أساسي` أو أكثر من ملف).

**مهم:** يجب أن يكون كل الكود في **ملف واحد فقط**.

- إذا كان عندك **أكثر من ملف** (مثل `Code.gs` و `Another.gs`):
  - افتح كل ملف وتأكد أي واحد فيه `function doGet(e)`.
  - انسخ **كل** محتوى ملف `google-apps-script.js` من مشروع LuckyWheel.
  - **احذف** محتوى ملف **Code.gs** (أو الملف الذي اسمه يشبه الافتراضي) بالكامل.
  - **الصق** فيه كل الكود الذي نسخته.
  - احذف أي ملف **.gs** آخر أو افرغه واترك فيه سطر واحد فقط: `// انظر Code.gs`
- إذا كان عندك **ملف واحد فقط**:
  - احذف كل محتواه، ثم الصق **كل** محتوى `google-apps-script.js` من المشروع.

4. اضغط **حفظ** (أيقونة القرص أو Ctrl+S).

---

## الخطوة 2: التأكد من وجود doGet

1. في أعلى المحرر يوجد قائمة منسدلة بجانب زر **تنفيذ**.
2. اضغط عليها وتأكد أنك ترى **doGet** في القائمة.
3. إن **لم** تظهر doGet: ارجع للخطوة 1 وتأكد أنك الصقت الكود **كاملاً** في الملف الرئيسي (Code.gs).

---

## الخطوة 3: نشر جديد بالكامل (مهم)

لا نكتفي بتحديث إصدار؛ ننشئ **نشراً جديداً** لنتأكد أن الرابط يشغّل الكود الحالي.

1. من القائمة: **نشر (Deploy)** → **إدارة عمليات النشر (Manage deployments)**.
2. اضغط **إنشاء نشر (Create deployment)** أو الزر الذي يضيف نشراً جديداً.
3. بجانب "اختر النوع" اختر **تطبيق ويب (Web app)**.
4. الإعدادات:
   - **تنفيذ التطبيق باسم:** أنا (بريدك الإلكتروني).
   - **من يمكنه الوصول إلى التطبيق:** **أي شخص (Anyone)**.
5. اضغط **نشر (Deploy)**.
6. قد يطلب منك التفويض (الموافقة على الصلاحيات) — وافق حتى النهاية.
7. انسخ **رابط تطبيق الويب (Web app URL)** الظاهر أمامك — هذا هو الرابط الجديد.

---

## الخطوة 4: استخدام الرابط الجديد في الموقع

1. افتح موقع عجلة الحظ وادخل إلى **لوحة التحكم / الإعدادات**.
2. في حقل **رابط نشر التطبيق** (أو رابط Google Script): **احذف** الرابط القديم والصق **الرابط الجديد** الذي نسخته.
3. احفظ الإعدادات.

---

## الخطوة 5: التحقق

افتح في المتصفح الرابط الجديد مع إضافة في آخره:

```
?action=getSettings
```

مثال (استبدل الرابط برابطك):

```
https://script.google.com/macros/s/XXXX/exec?action=getSettings
```

- إذا ظهر نص JSON مثل: `{"success":true,"settings":{...}}` ← **تم الحل**، و doGet تعمل.
- إذا ظهرت مرة أخرى "تعذر العثور على دالة doGet" ← الرابط الذي فتحته **ليس** رابط النشر الجديد من الخطوة 3، أو لم تُحفظ التعديلات في الخطوة 1.

---

## ملخص السبب

| المشكلة | السبب |
|--------|--------|
| تعذر العثور على doGet | الإصدار **المُنشَر** قديم أو من مشروع/ملف آخر ولا يحتوي على دالة doGet. |
| الحل | كود كامل في ملف واحد → **إنشاء نشر جديد** (وليس فقط "تحديث إصدار") → استخدام الرابط الجديد في الموقع. |
